<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  
  <!-- Content Security Policy for Security -->
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; font-src https://cdnjs.cloudflare.com; img-src 'self' data:;">
  
  <title>GospelSwipe Pro - Digital Evangelism Platform</title>
  
  <!-- PWA Meta Tags -->
  <meta name="theme-color" content="#2c3e50">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="GospelSwipe">
  <meta name="description" content="AI-powered gospel presentation with prayer journal, multi-language support, and offline evangelism tools">
  <meta name="keywords" content="evangelism, gospel, bible, prayer, christian, Nigeria">
  
  <!-- PWA Manifest -->
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>‚úùÔ∏è</text></svg>">
  
  <!-- Fonts & Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <!-- Styles -->
  <style>
    /* ===== CSS VARIABLES ===== */
    :root {
      --primary: #2c3e50;
      --secondary: #3498db;
      --accent: #e74c3c;
      --light: #ecf0f1;
      --dark: #1a1a1a;
      --success: #27ae60;
      --warning: #f39c12;
      --radius: 12px;
      --shadow: 0 8px 30px rgba(0,0,0,0.12);
      --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    /* ===== BASE STYLES ===== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }
    
    html {
      height: 100%;
      overflow: hidden;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      background: linear-gradient(135deg, var(--primary) 0%, #34495e 100%);
      color: var(--light);
      min-height: 100vh;
      position: relative;
      transition: var(--transition);
    }
    
    body.dark-mode {
      background: linear-gradient(135deg, #0f1419 0%, #1a252f 100%);
    }
    
    /* Skeleton loader styles */
    .skeleton-text {
      height: 20px;
      background: linear-gradient(90deg, rgba(255,255,255,0.1) 25%, rgba(255,255,255,0.2) 50%, rgba(255,255,255,0.1) 75%);
      background-size: 200% 100%;
      animation: shimmer 1.5s infinite;
      border-radius: 4px;
      margin: 10px 0;
    }
    
    .skeleton-card {
      background: rgba(255,255,255,0.05);
      border-radius: var(--radius);
      padding: 20px;
      min-height: 140px;
      margin-bottom: 15px;
    }
    
    @keyframes shimmer {
      0% { background-position: -200px 0; }
      100% { background-position: 200px 0; }
    }
    
    /* ===== SWITCH TOGGLE STYLES ===== */
    .switch {
      position: relative;
      display: inline-block;
      width: 50px;
      height: 24px;
    }
    
    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    
    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(255,255,255,0.3);
      transition: .4s;
      border-radius: 24px;
    }
    
    .slider:before {
      position: absolute;
      content: "";
      height: 16px;
      width: 16px;
      left: 4px;
      bottom: 4px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }
    
    input:checked + .slider {
      background-color: var(--secondary);
    }
    
    input:checked + .slider:before {
      transform: translateX(26px);
    }
    
    /* ===== LOADING SCREEN ===== */
    #loading {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: var(--primary);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      transition: opacity 0.5s;
    }
    
    .loader {
      width: 48px;
      height: 48px;
      border: 3px solid rgba(255,255,255,0.3);
      border-radius: 50%;
      border-top-color: var(--light);
      animation: spin 1s ease-in-out infinite;
      margin-bottom: 20px;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* ===== MAIN CONTAINER ===== */
    .app-container {
      display: none;
      position: relative;
      width: 100%;
      height: 100vh;
      overflow: hidden;
    }
    
    .app-container.active {
      display: block;
    }
    
    /* ===== HOME SCREEN ===== */
    #home-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      padding: 20px 20px 90px;
      display: flex;
      flex-direction: column;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
      z-index: 100;
      background: linear-gradient(135deg, var(--primary) 0%, #34495e 100%);
    }
    
    body.dark-mode #home-screen {
      background: linear-gradient(135deg, #0f1419 0%, #1a252f 100%);
    }
    
    .header {
      text-align: center;
      margin-top: 20px;
      flex-shrink: 0;
      position: relative;
    }
    
    .header h1 {
      font-size: 2.2rem;
      margin-bottom: 5px;
      background: linear-gradient(to right, #3498db, #2ecc71);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .header .tagline {
      font-size: 1rem;
      opacity: 0.8;
      margin-bottom: 30px;
    }
    
    /* ===== SETTINGS BUTTON IN HEADER ===== */
    .header-settings-btn {
      position: absolute;
      top: 0;
      right: 0;
      background: rgba(255,255,255,0.1);
      border: none;
      color: var(--light);
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: var(--transition);
      z-index: 10;
    }
    
    .header-settings-btn:hover {
      background: rgba(255,255,255,0.2);
      transform: rotate(30deg);
    }
    
    /* ===== FEATURE CARDS ===== */
    .features-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
      margin: 30px 0;
      flex: 1;
    }
    
    .feature-card {
      background: rgba(255,255,255,0.1);
      backdrop-filter: blur(10px);
      border-radius: var(--radius);
      padding: 20px;
      text-align: center;
      transition: var(--transition);
      border: 1px solid rgba(255,255,255,0.1);
      cursor: pointer;
      display: flex;
      flex-direction: column;
      justify-content: center;
      min-height: 140px;
    }
    
    .feature-card:hover {
      transform: translateY(-5px);
      background: rgba(255,255,255,0.15);
    }
    
    .feature-card i {
      font-size: 1.8rem;
      margin-bottom: 10px;
      color: var(--secondary);
    }
    
    /* ===== FIXED SLIDE CONTAINER ===== */
    .slides-container {
      position: relative;
      width: 100%;
      height: 100%;
      overflow: hidden;
    }
    
    .slide {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      padding: 60px 20px 120px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      opacity: 0;
      transform: translateX(100%);
      transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.3s;
      background: linear-gradient(135deg, #2c3e50 0%, #4a6491 100%);
      z-index: 1;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
      pointer-events: none;
    }
    
    .slide.active {
      opacity: 1;
      transform: translateX(0);
      z-index: 3;
      pointer-events: all;
    }
    
    .slide.previous {
      opacity: 1;
      transform: translateX(-100%);
      z-index: 2;
      pointer-events: none;
    }
    
    .slide.next {
      opacity: 0;
      transform: translateX(100%);
      z-index: 1;
      pointer-events: none;
    }
    
    .slide-content {
      max-width: 600px;
      width: 90%;
    }
    
    .slide-header {
      margin-bottom: 30px;
    }
    
    .slide-number {
      background: rgba(255,255,255,0.1);
      border-radius: 20px;
      padding: 5px 15px;
      font-size: 0.9rem;
      margin-bottom: 15px;
      display: inline-block;
    }
    
    .slide-title {
      font-size: 1.8rem;
      margin-bottom: 20px;
      line-height: 1.3;
    }
    
    .slide-verse {
      font-size: 1.3rem;
      line-height: 1.6;
      margin-bottom: 20px;
      padding: 20px;
      background: rgba(0,0,0,0.2);
      border-radius: var(--radius);
      border-left: 4px solid var(--secondary);
    }
    
    .slide-reference {
      font-style: italic;
      opacity: 0.8;
      margin-bottom: 30px;
    }
    
    /* ===== SWIPE INDICATORS ===== */
    .swipe-indicator {
      position: absolute;
      bottom: 100px;
      width: 100%;
      display: flex;
      justify-content: center;
      gap: 20px;
      opacity: 0.7;
      transition: var(--transition);
    }
    
    .swipe-left, .swipe-right {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 0.9rem;
    }
    
    /* ===== FIXED: BOTTOM NAVIGATION ===== */
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 70px;
      background: rgba(0,0,0,0.95);
      backdrop-filter: blur(20px);
      display: flex;
      justify-content: space-around;
      align-items: center;
      padding: 0;
      border-top: 1px solid rgba(255,255,255,0.1);
      z-index: 1000;
    }
    
    .nav-btn {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 4px;
      background: none;
      border: none;
      color: var(--light);
      opacity: 0.7;
      transition: var(--transition);
      padding: 8px 12px;
      min-width: 60px;
      height: 70px;
      cursor: pointer;
      text-decoration: none;
    }
    
    .nav-btn.active {
      opacity: 1;
      color: var(--secondary);
    }
    
    .nav-btn i {
      font-size: 1.2rem;
    }
    
    .nav-btn span {
      font-size: 0.7rem;
    }
    
    /* ===== FIXED: SCREEN MANAGEMENT ===== */
    .screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      padding: 20px 20px 90px;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
      background: linear-gradient(135deg, var(--primary) 0%, #34495e 100%);
      transform: translateX(100%);
      transition: transform 0.3s ease;
      z-index: 200;
      display: flex;
      flex-direction: column;
    }
    
    body.dark-mode .screen {
      background: linear-gradient(135deg, #0f1419 0%, #1a252f 100%);
    }
    
    .screen.active {
      transform: translateX(0);
      z-index: 200;
    }
    
    /* Presentation screen should be full height without bottom padding */
    #presentation-screen {
      padding: 0;
      z-index: 300;
    }
    
    #presentation-screen.active {
      z-index: 300;
    }
    
    /* ===== PRAYER JOURNAL ===== */
    .journal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      flex-shrink: 0;
    }
    
    #prayerInput {
      width: 100%;
      min-height: 120px;
      max-height: 200px;
      padding: 15px;
      border-radius: var(--radius);
      border: 2px solid rgba(255,255,255,0.1);
      background: rgba(255,255,255,0.05);
      color: var(--light);
      font-size: 1rem;
      resize: vertical;
      margin-bottom: 20px;
      flex-shrink: 0;
    }
    
    .prayer-actions {
      display: flex;
      gap: 10px;
      margin-bottom: 30px;
      flex-shrink: 0;
    }
    
    .action-btn {
      flex: 1;
      padding: 12px;
      border-radius: var(--radius);
      border: none;
      background: var(--secondary);
      color: white;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
    }
    
    .action-btn:hover {
      opacity: 0.9;
      transform: translateY(-2px);
    }
    
    .prayer-list {
      display: flex;
      flex-direction: column;
      gap: 15px;
      flex: 1;
      overflow-y: auto;
    }
    
    .prayer-item {
      background: rgba(255,255,255,0.05);
      border-radius: var(--radius);
      padding: 15px;
      border-left: 4px solid var(--success);
    }
    
    .prayer-item.answered {
      border-left-color: var(--accent);
      opacity: 0.7;
    }
    
    .prayer-date {
      font-size: 0.8rem;
      opacity: 0.6;
      margin-bottom: 5px;
    }
    
    /* ===== SETTINGS SCREEN ===== */
    .settings-section {
      margin-bottom: 30px;
      flex-shrink: 0;
    }
    
    .settings-title {
      font-size: 1rem;
      opacity: 0.8;
      margin-bottom: 15px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    .settings-option {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px;
      background: rgba(255,255,255,0.05);
      border-radius: var(--radius);
      margin-bottom: 10px;
    }
    
    /* ===== STATISTICS ===== */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
      margin-bottom: 30px;
      flex-shrink: 0;
    }
    
    .stat-card {
      background: rgba(255,255,255,0.05);
      border-radius: var(--radius);
      padding: 20px;
      text-align: center;
    }
    
    .stat-value {
      font-size: 2rem;
      font-weight: bold;
      color: var(--secondary);
      margin-bottom: 5px;
    }
    
    .stat-label {
      font-size: 0.9rem;
      opacity: 0.7;
    }
    
    /* ===== MODAL SYSTEM ===== */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.9);
      backdrop-filter: blur(10px);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 2000;
      padding: 20px;
      opacity: 0;
      transition: opacity 0.3s;
    }
    
    .modal-overlay.active {
      opacity: 1;
    }
    
    .modal-content {
      background: linear-gradient(135deg, #2c3e50, #34495e);
      padding: 30px;
      border-radius: 20px;
      max-width: 500px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
      transform: translateY(20px);
      transition: transform 0.3s;
      position: relative;
    }
    
    .modal-overlay.active .modal-content {
      transform: translateY(0);
    }
    
    /* ===== NOTIFICATION ===== */
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background: var(--success);
      color: white;
      padding: 15px 25px;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      transform: translateX(150%);
      transition: transform 0.3s;
      z-index: 2000;
      max-width: 300px;
    }
    
    .notification.show {
      transform: translateX(0);
    }
    
    /* ===== EXIT BUTTON ===== */
    .exit-btn {
      position: fixed;
      top: 20px;
      left: 20px;
      background: rgba(0,0,0,0.5);
      border: none;
      color: white;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }
    
    /* ===== HOME BOTTOM BUTTONS ===== */
    .home-bottom-buttons {
      text-align: center;
      margin-top: auto;
      padding-bottom: 20px;
      flex-shrink: 0;
    }
    
    .home-bottom-buttons button {
      background: linear-gradient(135deg, #2ecc71, #27ae60);
      color: white;
      border: none;
      padding: 12px 30px;
      border-radius: 25px;
      font-weight: bold;
      cursor: pointer;
      margin: 5px;
      transition: var(--transition);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      width: 100%;
      max-width: 300px;
      margin-left: auto;
      margin-right: auto;
    }
    
    .home-bottom-buttons button:hover {
      opacity: 0.9;
      transform: translateY(-2px);
    }
    
    .home-bottom-buttons button.secondary {
      background: transparent;
      border: 1px solid rgba(255,255,255,0.3);
    }
    
    /* ===== RESPONSIVE DESIGN ===== */
    @media (max-width: 768px) {
      .features-grid {
        grid-template-columns: 1fr;
      }
      
      .slide-title {
        font-size: 1.5rem;
      }
      
      .slide-verse {
        font-size: 1.1rem;
      }
      
      .screen {
        padding: 20px 15px 90px;
      }
      
      .header h1 {
        font-size: 1.8rem;
      }
    }
    
    @media (max-width: 480px) {
      .nav-btn span {
        display: none;
      }
      
      .nav-btn i {
        font-size: 1.5rem;
      }
      
      .features-grid {
        gap: 10px;
      }
      
      .feature-card {
        padding: 15px;
        min-height: 120px;
      }
      
      .home-bottom-buttons button {
        padding: 10px 20px;
        font-size: 0.9rem;
      }
    }
    
    /* ===== SAFE AREA SUPPORT ===== */
    @supports (padding: max(0px)) {
      .bottom-nav {
        padding-bottom: env(safe-area-inset-bottom);
        height: calc(70px + env(safe-area-inset-bottom));
      }
      
      .screen {
        padding-bottom: calc(90px + env(safe-area-inset-bottom));
      }
      
      #presentation-screen {
        padding-bottom: env(safe-area-inset-bottom);
      }
    }
    
    /* ===== ANIMATIONS ===== */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .fade-in {
      animation: fadeIn 0.5s ease-out;
    }
    
    /* ===== ACCESSIBILITY ===== */
    @media (prefers-reduced-motion: reduce) {
      * {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
    }
    
    /* ===== SCROLLBAR ===== */
    ::-webkit-scrollbar {
      width: 6px;
    }
    
    ::-webkit-scrollbar-track {
      background: rgba(0,0,0,0.1);
    }
    
    ::-webkit-scrollbar-thumb {
      background: rgba(255,255,255,0.2);
      border-radius: 3px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: rgba(255,255,255,0.3);
    }
  </style>
</head>
<body>
  <!-- Loading Screen -->
  <div id="loading">
    <div class="loader"></div>
    <h2 style="margin-bottom: 10px;">GospelSwipe Pro</h2>
    <p style="opacity: 0.7; text-align: center; max-width: 300px;">
      Loading your digital evangelism toolkit...
    </p>
    <div style="margin-top: 30px; font-size: 0.8rem; opacity: 0.5;">
      <span id="loadingProgress">0%</span> ‚Ä¢ Made in üá≥üá¨
    </div>
  </div>

  <!-- Main App Container -->
  <div class="app-container" id="appContainer">
    
    <!-- Home Screen -->
    <div id="home-screen" class="screen active">
      <div class="header">
        <button class="header-settings-btn" onclick="showScreen('settings-screen')" title="Settings">
          <i class="fas fa-cog"></i>
        </button>
        <h1><i class="fas fa-cross"></i> GospelSwipe Pro</h1>
        <p class="tagline">Your pocket evangelism toolkit</p>
        
        <div class="user-stats" style="margin-bottom: 30px;">
          <div style="display: flex; gap: 15px; justify-content: center;">
            <div style="text-align: center;">
              <div id="streakCount" style="font-size: 2rem; font-weight: bold; color: #f39c12;">0</div>
              <div style="font-size: 0.8rem; opacity: 0.7;">Day Streak</div>
            </div>
            <div style="text-align: center;">
              <div id="versesShared" style="font-size: 2rem; font-weight: bold; color: #2ecc71;">0</div>
              <div style="font-size: 0.8rem; opacity: 0.7;">Verses Shared</div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="features-grid">
        <!-- Original features -->
        <div class="feature-card" onclick="startPresentation()">
          <i class="fas fa-play-circle"></i>
          <h3>Start Presentation</h3>
          <p style="font-size: 0.9rem; opacity: 0.8;">10-slide gospel journey</p>
        </div>
        
        <div class="feature-card" onclick="showScreen('prayer-screen')">
          <i class="fas fa-pray"></i>
          <h3>Prayer Journal</h3>
          <p style="font-size: 0.9rem; opacity: 0.8;">Save & track prayers</p>
        </div>
        
        <div class="feature-card" onclick="showDailyVerse()">
          <i class="fas fa-book-bible"></i>
          <h3>Daily Verse</h3>
          <p style="font-size: 0.9rem; opacity: 0.8;">Personalized for you</p>
        </div>
        
        <div class="feature-card" onclick="showScreen('stats-screen')">
          <i class="fas fa-chart-line"></i>
          <h3>My Progress</h3>
          <p style="font-size: 0.9rem; opacity: 0.8;">Track your journey</p>
        </div>
        
        <div class="feature-card" onclick="showLanguageSettings()">
          <i class="fas fa-language"></i>
          <h3>Multi-language</h3>
          <p style="font-size: 0.9rem; opacity: 0.8;">English & Nigerian</p>
        </div>
        
        <div class="feature-card" onclick="shareApp()">
          <i class="fas fa-share-alt"></i>
          <h3>Share Gospel</h3>
          <p style="font-size: 0.9rem; opacity: 0.8;">Invite others</p>
        </div>
        
        <!-- NEW: AI Prayer Assistant Feature -->
        <div class="feature-card" onclick="showPrayerAssistant()" style="background: linear-gradient(135deg, rgba(52, 152, 219, 0.2), rgba(142, 68, 173, 0.2)); border: 1px solid rgba(52, 152, 219, 0.3);">
          <i class="fas fa-robot" style="color: #3498db;"></i>
          <h3>AI Prayer Guide</h3>
          <p style="font-size: 0.9rem; opacity: 0.8;">Personalized prayer help</p>
          <span style="background: rgba(52, 152, 219, 0.2); color: #3498db; padding: 2px 8px; border-radius: 10px; font-size: 0.7rem; margin-top: 5px;">AI POWERED</span>
        </div>
        
        <!-- NEW: Impact Dashboard Feature -->
        <div class="feature-card" onclick="showImpactScreen()" style="background: linear-gradient(135deg, rgba(243, 156, 18, 0.2), rgba(230, 126, 34, 0.2)); border: 1px solid rgba(243, 156, 18, 0.3);">
          <i class="fas fa-chart-bar" style="color: #f39c12;"></i>
          <h3>Our Impact</h3>
          <p style="font-size: 0.9rem; opacity: 0.8;">Growth & grant data</p>
          <span style="background: rgba(243, 156, 18, 0.2); color: #f39c12; padding: 2px 8px; border-radius: 10px; font-size: 0.7rem; margin-top: 5px;">GRANT READY</span>
        </div>
      </div>
      
      <div class="home-bottom-buttons">
        <div style="opacity: 0.7; font-size: 0.9rem; margin-bottom: 10px; text-align: center;">
          üîí Works 100% Offline ‚Ä¢ ‚ö° Instant Load
        </div>
        <button onclick="installApp()" id="installBtn">
          <i class="fas fa-download"></i> Install App
        </button>
      </div>
    </div>
    
    <!-- Presentation Slides -->
    <div id="presentation-screen" class="screen">
      <button class="exit-btn" onclick="exitPresentation()">
        <i class="fas fa-times"></i>
      </button>
      <div class="slides-container" id="slidesContainer">
        <!-- Slides will be dynamically generated -->
      </div>
    </div>
    
    <!-- Prayer Journal -->
    <div id="prayer-screen" class="screen">
      <div class="journal-header">
        <h2><i class="fas fa-pray"></i> Prayer Journal</h2>
        <button onclick="showScreen('home-screen')" style="background: none; border: none; color: white; font-size: 1.2rem; cursor: pointer;">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <textarea id="prayerInput" placeholder="Pour out your heart to God... You can write in English, Pidgin, Yoruba, Igbo, or Hausa"></textarea>
      
      <div class="prayer-actions">
        <button class="action-btn" onclick="savePrayer()">
          <i class="fas fa-save"></i> Save Prayer
        </button>
        <button class="action-btn" onclick="recordVoicePrayer()" style="background: var(--accent);">
          <i class="fas fa-microphone"></i> Voice Prayer
        </button>
        <!-- NEW: AI Prayer Assistant Button -->
        <button class="action-btn" onclick="showPrayerAssistant()" style="background: linear-gradient(135deg, #3498db, #8e44ad);">
          <i class="fas fa-robot"></i> AI Guide
        </button>
      </div>
      
      <h3 style="margin-bottom: 15px;">Your Prayer History</h3>
      <div id="prayerList" class="prayer-list">
        <!-- Skeleton loader while loading prayers -->
        <div id="prayerSkeleton" style="display: none;">
          <div class="skeleton-card"></div>
          <div class="skeleton-card"></div>
        </div>
      </div>
    </div>
    
    <!-- Statistics Screen -->
    <div id="stats-screen" class="screen">
      <div class="journal-header">
        <h2><i class="fas fa-chart-line"></i> My Evangelism Stats</h2>
        <button onclick="showScreen('home-screen')" style="background: none; border: none; color: white; font-size: 1.2rem; cursor: pointer;">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-value" id="totalSlides">0</div>
          <div class="stat-label">Slides Viewed</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="prayerCount">0</div>
          <div class="stat-label">Prayers Saved</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="streakDays">0</div>
          <div class="stat-label">Day Streak</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="aiQuestions">0</div>
          <div class="stat-label">AI Questions</div>
        </div>
      </div>
      
      <div class="settings-section">
        <div class="settings-title">Recent Achievements</div>
        <div id="achievementsList">
          <!-- Skeleton loader for achievements -->
          <div class="skeleton-text" style="width: 80%;"></div>
          <div class="skeleton-text" style="width: 60%;"></div>
        </div>
      </div>
      
      <div style="text-align: center; margin-top: 30px; padding: 20px; background: rgba(46, 204, 113, 0.1); border-radius: var(--radius);">
        <h3><i class="fas fa-award"></i> Evangelism Level</h3>
        <div style="font-size: 2rem; font-weight: bold; color: #f39c12;" id="userLevel">Beginner</div>
        <div style="margin-top: 10px; opacity: 0.8;">
          Keep sharing the gospel to level up!
        </div>
      </div>
    </div>
    
    <!-- Settings Screen -->
    <div id="settings-screen" class="screen">
      <div class="journal-header">
        <h2><i class="fas fa-cog"></i> Settings</h2>
        <button onclick="showScreen('home-screen')" style="background: none; border: none; color: white; font-size: 1.2rem; cursor: pointer;">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div class="settings-section">
        <div class="settings-title">Appearance</div>
        <div class="settings-option">
          <span>Dark Mode</span>
          <label class="switch">
            <input type="checkbox" id="darkModeToggle" onchange="toggleDarkMode()">
            <span class="slider"></span>
          </label>
        </div>
        <div class="settings-option">
          <span>Language</span>
          <select id="languageSelect" onchange="changeLanguage()" style="background: rgba(255,255,255,0.1); color: white; border: none; padding: 5px; border-radius: 5px; cursor: pointer;">
            <option value="en">English</option>
            <option value="yo">Yoruba</option>
            <option value="ig">Igbo</option>
            <option value="ha">Hausa</option>
            <option value="pcm">Nigerian Pidgin</option>
          </select>
        </div>
      </div>
      
      <div class="settings-section">
        <div class="settings-title">Audio Settings</div>
        <div class="settings-option">
          <span>Voice Speed</span>
          <select id="voiceSpeed" onchange="updateVoiceSettings()" style="background: rgba(255,255,255,0.1); color: white; border: none; padding: 5px; border-radius: 5px; cursor: pointer;">
            <option value="0.8">Slow</option>
            <option value="1" selected>Normal</option>
            <option value="1.2">Fast</option>
          </select>
        </div>
        <div class="settings-option">
          <span>Auto-play Audio</span>
          <label class="switch">
            <input type="checkbox" id="autoPlayToggle">
            <span class="slider"></span>
          </label>
        </div>
      </div>
      
      <!-- NEW: Privacy & Security Section -->
      <div class="settings-section" style="background: rgba(46, 204, 113, 0.1); border: 1px solid rgba(46, 204, 113, 0.3); border-radius: var(--radius); padding: 15px;">
        <div class="settings-title"><i class="fas fa-shield-alt"></i> Privacy & Security</div>
        <div style="font-size: 0.9rem; opacity: 0.8; margin-bottom: 15px;">
          ‚úÖ All data stored locally on device<br>
          ‚úÖ No tracking cookies<br>
          ‚úÖ Offline-first design<br>
          ‚úÖ Open source & auditable<br>
          ‚è≥ GDPR compliance (grant needed)
        </div>
        <button onclick="exportPrivacyReport()" style="width: 100%; padding: 12px; background: rgba(46, 204, 113, 0.2); border: 1px solid rgba(46, 204, 113, 0.5); color: white; border-radius: var(--radius); cursor: pointer;">
          <i class="fas fa-file-csv"></i> Export Privacy Audit Log
        </button>
      </div>
      
      <div class="settings-section">
        <div class="settings-title">Data Management</div>
        <button onclick="exportData()" style="width: 100%; padding: 15px; background: rgba(52, 152, 219, 0.2); border: 1px solid rgba(52, 152, 219, 0.5); color: white; border-radius: var(--radius); margin-bottom: 10px; cursor: pointer;">
          <i class="fas fa-download"></i> Export My Data
        </button>
        <button onclick="clearData()" style="width: 100%; padding: 15px; background: rgba(231, 76, 60, 0.2); border: 1px solid rgba(231, 76, 60, 0.5); color: white; border-radius: var(--radius); cursor: pointer;">
          <i class="fas fa-trash"></i> Clear All Data
        </button>
      </div>
      
      <div style="text-align: center; margin-top: 30px; opacity: 0.7; font-size: 0.9rem;">
        <div>GospelSwipe Pro v2.1</div>
        <div>Built with ‚ù§Ô∏è in Nigeria</div>
        <div style="margin-top: 10px;">
          <button onclick="window.open('https://ko-fi.com/gospelswipe', '_blank')" style="background: linear-gradient(135deg, #FF5E5E, #FF8C42); color: white; border: none; padding: 10px 20px; border-radius: 20px; cursor: pointer; margin: 5px;">
            <i class="fas fa-coffee"></i> Support on Ko-fi
          </button>
        </div>
      </div>
    </div>
    
    <!-- Bottom Navigation -->
    <div class="bottom-nav">
      <button class="nav-btn active" onclick="showScreen('home-screen')">
        <i class="fas fa-home"></i>
        <span>Home</span>
      </button>
      <button class="nav-btn" onclick="startPresentation()">
        <i class="fas fa-play"></i>
        <span>Present</span>
      </button>
      <button class="nav-btn" onclick="showScreen('prayer-screen')">
        <i class="fas fa-pray"></i>
        <span>Prayer</span>
      </button>
      <button class="nav-btn" onclick="showScreen('stats-screen')">
        <i class="fas fa-chart-line"></i>
        <span>Stats</span>
      </button>
    </div>
    
    <!-- Notification System -->
    <div id="notification" class="notification">
      <div id="notificationMessage">Notification</div>
    </div>
  </div>

  <!-- JavaScript -->
  <script>
    // ==================== APP DATA ====================
    const APP_DATA = {
      name: "GospelSwipe Pro",
      version: "2.1.0",
      slides: [
        {
          id: 1,
          title: "God's Love for You",
          verse: "For God so loved the world that he gave his one and only Son, that whoever believes in him shall not perish but have eternal life.",
          reference: "John 3:16",
          topic: "god-love",
          color: "#3498db",
          category: "gospel-core"
        },
        {
          id: 2,
          title: "Our Problem: Sin",
          verse: "For all have sinned and fall short of the glory of God.",
          reference: "Romans 3:23",
          topic: "sin-problem",
          color: "#e74c3c",
          category: "gospel-core"
        },
        {
          id: 3,
          title: "God's Solution: Jesus",
          verse: "But God demonstrates his own love for us in this: While we were still sinners, Christ died for us.",
          reference: "Romans 5:8",
          topic: "jesus-solution",
          color: "#2ecc71",
          category: "gospel-core"
        },
        {
          id: 4,
          title: "Our Response: Faith",
          verse: "For it is by grace you have been saved, through faith‚Äîand this is not from yourselves, it is the gift of God.",
          reference: "Ephesians 2:8-9",
          topic: "faith-response",
          color: "#9b59b6",
          category: "gospel-core"
        },
        {
          id: 5,
          title: "New Life in Christ",
          verse: "Therefore, if anyone is in Christ, the new creation has come: The old has gone, the new is here!",
          reference: "2 Corinthians 5:17",
          topic: "new-life",
          color: "#1abc9c",
          category: "discipleship"
        },
        {
          id: 6,
          title: "The Holy Trinity",
          verse: "Therefore go and make disciples of all nations, baptizing them in the name of the Father and of the Son and of the Holy Spirit.",
          reference: "Matthew 28:19",
          topic: "trinity",
          color: "#34495e",
          category: "doctrine"
        },
        {
          id: 7,
          title: "Authority of Scripture",
          verse: "All Scripture is God-breathed and is useful for teaching, rebuking, correcting and training in righteousness.",
          reference: "2 Timothy 3:16",
          topic: "scripture",
          color: "#d35400",
          category: "doctrine"
        },
        {
          id: 8,
          title: "Purpose in Suffering",
          verse: "And we know that in all things God works for the good of those who love him, who have been called according to his purpose.",
          reference: "Romans 8:28",
          topic: "suffering",
          color: "#7f8c8d",
          category: "comfort"
        },
        {
          id: 9,
          title: "Jesus is the Only Way",
          verse: "Jesus answered, 'I am the way and the truth and the life. No one comes to the Father except through me.'",
          reference: "John 14:6",
          topic: "only-way",
          color: "#f39c12",
          category: "gospel-core"
        },
        {
          id: 10,
          title: "Prayer of Salvation",
          verse: "If you declare with your mouth, 'Jesus is Lord,' and believe in your heart that God raised him from the dead, you will be saved.",
          reference: "Romans 10:9",
          topic: "salvation-prayer",
          color: "#27ae60",
          category: "gospel-core"
        }
      ],
      
      // NEW: AI Prayer Assistant Data (Hardcoded for Demo)
      aiPrayerAssistant: {
        categories: {
          salvation: {
            title: "Prayer for Salvation",
            prompts: [
              "Lord Jesus, I confess that I am a sinner. I believe you died on the cross for my sins. Please forgive me and come into my heart. I want to follow you all the days of my life. Amen.",
              "Heavenly Father, I realize I need a Savior. I turn away from my sins and receive your gift of salvation through Jesus Christ. Transform my heart and make me new. Amen.",
              "Jesus, I believe you are the Son of God. I accept your sacrifice on the cross for me. I surrender my life to you. Be my Lord and Savior. Amen."
            ],
            guidance: "Pray sincerely from your heart. God hears every genuine prayer. This is the most important decision you'll ever make."
          },
          healing: {
            title: "Prayer for Healing",
            prompts: [
              "Great Physician, I come to you today asking for healing. You know the pain and suffering in my body and soul. Please touch me with your healing power and restore my health. I trust in your goodness. Amen.",
              "Lord, your word says you heal all my diseases. I claim that promise today. Heal me, O Lord, and I will be healed; save me and I will be saved. I put my trust in you. Amen.",
              "Compassionate God, I pray for healing from this affliction. Whether by miracle or medicine, guide my path to wholeness. Give strength to my body and peace to my spirit. Amen."
            ],
            guidance: "God is our healer. Pray with faith, but also seek appropriate medical care. Healing comes in many forms‚Äîphysical, emotional, and spiritual."
          },
          guidance: {
            title: "Prayer for Guidance",
            prompts: [
              "Lord, I need your direction in my life. Your word says you will guide me along the best pathway for my life. Show me the way I should walk. I trust your wisdom above my own. Amen.",
              "Heavenly Father, I'm facing a difficult decision. Please give me wisdom and clarity. Open the right doors and close the wrong ones. Let your will be done in my life. Amen.",
              "God of all wisdom, I seek your counsel. Illuminate my path with your truth. Help me to hear your voice clearly and have the courage to follow where you lead. Amen."
            ],
            guidance: "God promises to guide those who seek Him. Stay in His word, pray consistently, and seek wise counsel from mature believers."
          },
          thanksgiving: {
            title: "Prayer of Thanksgiving",
            prompts: [
              "Gracious God, I thank you for your countless blessings. For life, health, family, and provision. Most of all, I thank you for your love and salvation through Jesus. My heart overflows with gratitude. Amen.",
              "Lord, thank you for being faithful even when I'm not. Thank you for your mercy that never runs out. Thank you for the gift of salvation and the promise of eternal life with you. Amen.",
              "Heavenly Father, I give thanks in all circumstances, knowing this is your will for me. Thank you for the blessings I see and those I don't yet recognize. You are good all the time. Amen."
            ],
            guidance: "A grateful heart pleases God. Make thanksgiving a daily practice, not just for big blessings, but for His constant presence and love."
          }
        }
      },
      
      aiAnswers: {
        "god-love": {
          en: "The greatest evidence of God's love is Jesus Christ. While we were sinners, Christ died for us (Romans 5:8). God's love is unconditional, sacrificial, and eternal.",
          yo: "Ifihan ti o tobi jul·ªç ti if·∫π ·ªål·ªçrun ni Jesu Kristi. Nigba ti a wa ni ·∫π·π£·∫π, Kristi k√∫ fun wa (Romu 5:8). If·∫π ·ªål·ªçrun ko ni ipo, iÃÄruÃÅnraÃÄ, ati ayeÃÅ to lailai.",
          ig: "Ihe akaebe kas·ªãn·ª• nke ·ªãh·ª•nanya Chukwu b·ª• Jisos Kraist. Mgbe any·ªã ka b·ª• nd·ªã mmehie, Kraist nw·ª•r·ª• maka any·ªã (Rom 5:8). ·ªäh·ª•nanya Chukwu enwegh·ªã at·ª•, nke ·ªãch·ª• √†j√†, na ebigh·ªã ebi.",
          ha: "Mafi girman shaida na son Allah shi ne Yesu Almasihu. Yayin da muke masu zunubi, Almasihu ya mutu a gare mu (Romawa 5:8). Soyayyar Allah ba ta da sharadi, sadaukarwa ce, kuma ta dore.",
          pcm: "Di big pass evidens for God love na Jesus Christ. Wen we still bi sinners, Christ die for us (Romans 5:8). God love no get condition, na sacrifice, and e dey forever."
        },
        "sin-problem": {
          en: "Sin is rebellion against God (Isaiah 59:2). It separates us from God, but Jesus paid the penalty on the cross (Romans 6:23).",
          yo: "·∫∏·π£·∫π j·∫π ijakadi si ·ªål·ªçrun (Aisaya 59:2). O ya wa s·ªçt·ªç si ·ªål·ªçrun, ·π£ugb·ªçn Jesu san iya naa lori agbelebu (Romu 6:23).",
          ig: "Mmehie b·ª• nnup·ª•si megide Chineke (A·ªãsa·ªãa 59:2). ·ªå na-ekewa any·ªã na Chineke, mana Jiz·ªç kw·ª•r·ª• ·ª•gw·ªç ah·ª• n'obe (Rom 6:23).",
          ha: "Zunubi sa…ìo ne ga Allah (Ishaya 59:2). Yana raba mu da Allah, amma Yesu ya biya diyya a kan gicciye (Romawa 6:23).",
          pcm: "Sin na disobedience against God. E separate us from God, but Jesus pay di penalty for cross."
        },
        "jesus-solution": {
          en: "Jesus is God's perfect sacrifice for sin (Hebrews 10:14). His resurrection proves victory over death (1 Corinthians 15:55-57).",
          yo: "Jesu ni ·∫πb·ªç pipe ti ·ªål·ªçrun fun ·∫π·π£·∫π (Hebru 10:14). Ajinde R·∫π fi iparun iku han (1 Korinti 15:55-57).",
          ig: "Jiz·ªç b·ª• √†j√† zuru oke nke Chineke maka mmehie (Nd·ªã Hibru 10:14). Mbilite n'·ªçnw·ª• ya gosip·ª•tara mmeri n'isi ·ªçnw·ª• (1 Nd·ªã K·ªçr·ªãnt 15:55-57).",
          ha: "Yesu cikakken hadaya ne ga zunubi (Ibraniyawa 10:14). Tashinsa ya tabbatar da nasara akan mutuwa (1 Korinti 15:55-57).",
          pcm: "Jesus na God perfect sacrifice for sin. Him resurrection show say him don win over death."
        },
        "faith-response": {
          en: "Faith is trusting completely in Jesus' finished work (Ephesians 2:8-9). It's not just belief but surrender to His lordship.",
          yo: "Igbagb·ªç ni gbigbarale si i·π£·∫π ti Jesu ti pari (Efesu 2:8-9). Kii ·π£e igbagb·ªç nikan ·π£ugb·ªçn ifikanbal·∫π si Ij·ªçba R·∫π.",
          ig: "Okwukwe b·ª• ·ªãt·ª•kwas·ªã obi kpamkpam n'·ªçr·ª• Jiz·ªç zuru ezu (Efesos 2:8-9). ·ªå b·ª•gh·ªã nan·ªã nkwenye kama ·ªãt·ªçgb·ªç onwe g·ªã n'aka ya.",
          ha: "Imani amincewa cikakken aikin Yesu (Afisawa 2:8-9). Ba imani kawai ba ne, amma mika wuya ga ubangijinsa.",
          pcm: "Faith na mean say you trust wetin Jesus do finish. E no be just to believe, but to surrender to am."
        },
        "new-life": {
          en: "In Christ, you become a new creation (2 Corinthians 5:17). The Holy Spirit empowers you to live for God daily.",
          yo: "Ninu Kristi, o di ·∫πda tuntun (2 Korinti 5:17). ·∫∏mi Mim·ªç ·π£e agbara fun ·ªç lati gbe fun ·ªål·ªçrun l·ªçj·ªç.",
          ig: "Na Kraist, ·ªã gh·ªçr·ªç ihe okike ·ªçh·ª•r·ª• (2 Nd·ªã K·ªçr·ªãnt 5:17). Mm·ª•·ªç Ns·ªç na-enye g·ªã ike ibi nd·ª• maka Chineke kwa ·ª•b·ªçch·ªã.",
          ha: "A cikin Almasihu, ka zama sabon halitta (2 Korinti 5:17). Ruhun Mai Tsarki yana ba ka iko don rayuwa ga Allah kowace rana.",
          pcm: "For inside Christ, you become new person. Holy Spirit dey give you power to live for God everyday."
        },
        "trinity": {
          en: "One God in three Persons: Father, Son, Holy Spirit (Matthew 28:19). Distinct yet united in purpose to save.",
          yo: "·ªål·ªçrun kan ninu ·∫∏ni M·∫πta: Baba, ·ªåm·ªç, ·∫∏mi Mim·ªç (Matteu 28:19). O yat·ªç ·π£ugb·ªçn j·ªçsin fun idi kan.",
          ig: "Otu Chineke n'ime mmad·ª• at·ªç: Nna, ·ªåkpara, Mm·ª•·ªç Ns·ªç (Mat·ªãu 28:19). Ha d·ªã iche ma jik·ªçtara ·ªçn·ª• n'ebumnuche iz·ªçp·ª•ta.",
          ha: "Allah daya cikin Mutum uku: Uba, ∆äa, Ruhun Mai Tsarki (Matta 28:19). Daban-daban amma ha…óe a cikin manufa ceto.",
          pcm: "One God for three Persons: Papa, Pikin, Holy Spirit. Dem dey different but dey together for one purpose to save."
        },
        "scripture": {
          en: "The Bible is God's inspired, infallible Word (2 Timothy 3:16). It's our final authority for faith and life.",
          yo: "Bibeli ni ·ªår·ªç ·ªål·ªçrun ti ·∫πmi ran si, ti ko le ·π£i·π£·∫π (2 Timoteu 3:16). O ni agbara ipari wa fun igbagb·ªç ati aye.",
          ig: "Akw·ª•kw·ªç Ns·ªç b·ª• Okwu Chineke sitere n'ike mm·ª•·ªç ns·ªç, nke na-adabagh·ªã (2 Timoti 3:16). ·ªå b·ª• ikike any·ªã ikpeaz·ª• maka okwukwe na nd·ª•.",
          ha: "Littafi Mai Tsarki kalmar Allah ce da ruhu ya ya yi wahayi (2 Timothawus 3:16). Ita ce hukuncin mu na ∆ôarshe ga imani da rayuwa.",
          pcm: "Bible na God word wey Holy Spirit inspire. E be our final authority for faith and life."
        },
        "suffering": {
          en: "God allows suffering to refine faith (1 Peter 1:7) and display His comfort (2 Corinthians 1:3-4). He'll end all pain (Revelation 21:4).",
          yo: "·ªål·ªçrun gba laaye iya lati se igbagb·ªç pipe (1 Peteru 1:7) ati fi Itunu R·∫π han (2 Korinti 1:3-4). Yoo pari gbogbo iroti lailai (I·π£ipaya 21:4).",
          ig: "Chinewe na-ekwe ka ah·ª•h·ª• d·ªã ka ihe na-edozi okwukwe (1 Pita 1:7) ma gosip·ª•ta nkasi obi Ya (2 Nd·ªã K·ªçr·ªãnt 1:3-4). ·ªå ga-akw·ª•s·ªã ihe mgbu niile (Mkpughe 21:4).",
          ha: "Allah yana barin wahala don tsaftace imani (1 Bitrus 1:7) da nuna Ta'aziyyarsa (2 Korinti 1:3-4). Zai kawo karshen duk wani zafi (Ru'ya ta Yohanna 21:4).",
          pcm: "God allow suffering to make faith better and show Him comfort. Him go end all pain for heaven."
        },
        "only-way": {
          en: "Jesus said 'I am THE way' (John 14:6). All other paths lead to destruction (Matthew 7:13-14).",
          yo: "Jesu so pe 'Emi ni ·ªçna NA' (Johanu 14:6). Gbogbo aw·ªçn ·ªçna miran yoo gbe si iparun (Matteu 7:13-14).",
          ig: "Jiz·ªç kwuru na 'Ab·ª• m ·ª§z·ªç ah·ª•' (J·ªçn 14:6). ·ª§z·ªç nd·ªã ·ªçz·ªç niile na-eduga na mbibi (Mat·ªãu 7:13-14).",
          ha: "Yesu ya ce 'Ni ne hanya' (Yohanna 14:6). Duk wasu hanyoyin suna kaiwa ga halaka (Matta 7:13-14).",
          pcm: "Jesus talk say 'Na me be di way.' All other roads dey lead to destruction."
        },
        "salvation-prayer": {
          en: "Pray: 'Lord Jesus, I confess I'm a sinner. I believe You died for me. Forgive me. I receive You as my Savior. Amen.'",
          yo: "Gbadura: 'Oluwa Jesu, Mo j·∫πwo pe Mo j·∫π ol·∫π·π£·∫π. Mo gbagb·ªç pe O ku fun mi. Forijin mi. Mo gba ·ªç bi ·ªålagbati mi. Amin.'",
          ig: "Kpee ekpere: 'Onyenwe any·ªã Jiz·ªç, ana m ekwup·ª•ta na m b·ª• onye mmehie. Ekwere m na ·ªã nw·ª•r·ª• n'ihi m. Gbaghara m. Ana m anabata G·ªã d·ªã ka Onye Nz·ªçp·ª•ta m. Amen.'",
          ha: "Yi addu'a: 'Ubangiji Yesu, na yi ikirarin zunubi ne. Na yi imani ka ka mutu a gare ni. Ka gafarta mini. Na kar…ìe ka a matsayin Cetonka. Amin.'",
          pcm: "Pray: 'Lord Jesus, I confess say I be sinner. I believe say you die for me. Forgive me. I receive you as my Savior. Amen.'"
        }
      },
      
      nigerianTranslations: {
        greetings: {
          en: "Peace be with you",
          yo: "Alaafia ki o ba ·ªç",
          ig: "Udo d·ªãr·ªã g·ªã",
          ha: "Aminci ya tabbata a gare ka",
          pcm: "Pepe dey your side"
        }
      },
      
      dailyVerses: [
        { verse: "The LORD is my shepherd, I lack nothing.", ref: "Psalm 23:1", topic: "trust" },
        { verse: "I can do all this through him who gives me strength.", ref: "Philippians 4:13", topic: "strength" },
        { verse: "For I know the plans I have for you, declares the LORD.", ref: "Jeremiah 29:11", topic: "hope" },
        { verse: "Trust in the LORD with all your heart.", ref: "Proverbs 3:5", topic: "wisdom" },
        { verse: "Be strong and courageous. Do not be afraid.", ref: "Joshua 1:9", topic: "courage" },
        { verse: "The joy of the LORD is your strength.", ref: "Nehemiah 8:10", topic: "joy" },
        { verse: "Cast all your anxiety on him because he cares for you.", ref: "1 Peter 5:7", topic: "peace" }
      ]
    };

    // ==================== APP STATE ====================
    let appState = {
      currentSlide: 0,
      currentScreen: 'home-screen',
      darkMode: localStorage.getItem('darkMode') === 'true',
      language: localStorage.getItem('language') || 'en',
      userStats: JSON.parse(localStorage.getItem('userStats') || '{"presentations": 0, "slidesViewed": [], "prayers": 0, "aiQuestions": 0, "shares": 0, "installDate": "", "events": []}'),
      prayers: JSON.parse(localStorage.getItem('prayers') || '[]'),
      streak: JSON.parse(localStorage.getItem('streak') || '{"lastDate": "", "count": 0}'),
      achievements: JSON.parse(localStorage.getItem('achievements') || '[]'),
      installed: localStorage.getItem('installed') === 'true',
      isSwiping: false,
      swipeStartX: 0,
      swipeStartY: 0
    };

    // ==================== INITIALIZATION ====================
    document.addEventListener('DOMContentLoaded', async function() {
      // Simulate loading progress
      let progress = 0;
      const interval = setInterval(() => {
        progress += 10;
        document.getElementById('loadingProgress').textContent = `${progress}%`;
        
        if (progress >= 100) {
          clearInterval(interval);
          setTimeout(() => {
            document.getElementById('loading').style.opacity = '0';
            setTimeout(() => {
              document.getElementById('loading').style.display = 'none';
              document.getElementById('appContainer').classList.add('active');
              
              // Initialize app
              initApp();
            }, 500);
          }, 500);
        }
      }, 100);
    });

    function initApp() {
      // Set dark mode
      if (appState.darkMode) {
        document.body.classList.add('dark-mode');
        document.getElementById('darkModeToggle').checked = true;
      }
      
      // Set language
      document.getElementById('languageSelect').value = appState.language;
      
      // Load user stats
      updateUserStats();
      
      // Check streak
      checkStreak();
      
      // Initialize slides
      initializeSlides();
      
      // Ensure only home screen is visible initially
      document.querySelectorAll('.screen').forEach(screen => {
        if (screen.id !== 'home-screen') {
          screen.style.display = 'none';
        } else {
          screen.style.display = 'flex';
        }
      });
      
      // Show welcome notification
      showNotification('Welcome to GospelSwipe Pro! Ready to share the gospel?', 'success');
      
      // Check if app can be installed
      checkInstallPrompt();
      
      // Initialize touch events for back swipe
      initTouchEvents();
    }

    // ==================== FIXED TOUCH EVENTS FOR BACK SWIPE ====================
    function initTouchEvents() {
      let touchStartX = 0;
      let touchStartY = 0;
      let touchEndX = 0;
      let touchEndY = 0;
      let isSwiping = false;
      
      document.addEventListener('touchstart', function(event) {
        touchStartX = event.changedTouches[0].screenX;
        touchStartY = event.changedTouches[0].screenY;
        isSwiping = true;
      }, { passive: true });
      
      document.addEventListener('touchmove', function(event) {
        if (!isSwiping) return;
        
        touchEndX = event.changedTouches[0].screenX;
        touchEndY = event.changedTouches[0].screenY;
        
        // Prevent vertical scrolling during horizontal swipe
        const diffX = Math.abs(touchStartX - touchEndX);
        const diffY = Math.abs(touchStartY - touchEndY);
        
        if (diffX > diffY && diffX > 10) {
          event.preventDefault();
        }
      }, { passive: false });
      
      document.addEventListener('touchend', function(event) {
        if (!isSwiping) return;
        
        touchEndX = event.changedTouches[0].screenX;
        touchEndY = event.changedTouches[0].screenY;
        handleSwipe(touchStartX, touchStartY, touchEndX, touchEndY);
        isSwiping = false;
      }, { passive: true });
    }
    
    function handleSwipe(startX, startY, endX, endY) {
      const diffX = startX - endX;
      const diffY = startY - endY;
      
      // Only process if it's a horizontal swipe (not vertical scroll)
      if (Math.abs(diffX) > Math.abs(diffY)) {
        // Minimum swipe distance
        if (Math.abs(diffX) > 50) {
          if (diffX > 0) {
            // Swipe left - next
            if (appState.currentScreen === 'presentation-screen') {
              nextSlide();
            }
          } else {
            // Swipe right - previous or back
            if (appState.currentScreen === 'presentation-screen') {
              prevSlide();
            } else if (appState.currentScreen !== 'home-screen') {
              // Swipe right to go back to home
              showScreen('home-screen');
            }
          }
        }
      }
    }

    // ==================== FIXED SCREEN MANAGEMENT ====================
    function showScreen(screenId) {
      // Hide all screens
      document.querySelectorAll('.screen').forEach(screen => {
        screen.classList.remove('active');
        setTimeout(() => {
          if (screen.id !== screenId) {
            screen.style.display = 'none';
          }
        }, 300);
      });
      
      // Update nav buttons
      document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
      
      // Show target screen
      const targetScreen = document.getElementById(screenId);
      if (targetScreen) {
        targetScreen.style.display = 'flex';
        setTimeout(() => {
          targetScreen.classList.add('active');
        }, 10);
      }
      
      appState.currentScreen = screenId;
      
      // Update nav button state
      if (screenId === 'home-screen') {
        document.querySelector('.nav-btn:nth-child(1)').classList.add('active');
      } else if (screenId === 'prayer-screen') {
        document.querySelector('.nav-btn:nth-child(3)').classList.add('active');
      } else if (screenId === 'stats-screen') {
        document.querySelector('.nav-btn:nth-child(4)').classList.add('active');
      }
      
      // Special handling for presentation screen
      if (screenId === 'presentation-screen') {
        document.querySelector('.bottom-nav').style.display = 'none';
      } else {
        document.querySelector('.bottom-nav').style.display = 'flex';
      }
      
      // Update content based on screen
      if (screenId === 'prayer-screen') {
        setTimeout(() => loadPrayers(), 100);
      } else if (screenId === 'stats-screen') {
        setTimeout(() => updateStatsDisplay(), 100);
      }
      
      // Reset scroll position
      window.scrollTo(0, 0);
    }

    // ==================== FIXED PRESENTATION SYSTEM ====================
    function initializeSlides() {
      const container = document.getElementById('slidesContainer');
      container.innerHTML = '';
      
      APP_DATA.slides.forEach((slide, index) => {
        const slideElement = document.createElement('div');
        slideElement.className = `slide ${index === 0 ? 'active' : 'next'}`;
        slideElement.id = `slide-${slide.id}`;
        slideElement.style.background = `linear-gradient(135deg, ${slide.color} 0%, ${darkenColor(slide.color, 30)} 100%)`;
        
        slideElement.innerHTML = `
          <div class="slide-content fade-in">
            <div class="slide-header">
              <div class="slide-number">Slide ${slide.id}/10</div>
              <h2 class="slide-title">${slide.title}</h2>
            </div>
            <div class="slide-verse">${slide.verse}</div>
            <div class="slide-reference">- ${slide.reference}</div>
            <div style="display: flex; gap: 10px; margin-top: 20px; flex-wrap: wrap; justify-content: center;">
              <button onclick="speakSlide(${slide.id})" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 12px 20px; border-radius: 25px; cursor: pointer; min-width: 100px;">
                <i class="fas fa-volume-up"></i> Listen
              </button>
              <button onclick="askAI('${slide.topic}')" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 12px 20px; border-radius: 25px; cursor: pointer; min-width: 100px;">
                <i class="fas fa-robot"></i> AI Explain
              </button>
              <button onclick="shareVerse('${slide.verse}', '${slide.reference}')" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 12px 20px; border-radius: 25px; cursor: pointer; min-width: 100px;">
                <i class="fas fa-share"></i> Share
              </button>
              <!-- Add share as image button -->
              <button onclick="shareVersePicture('${slide.verse}', '${slide.reference}', '${slide.title}')" style="background: linear-gradient(135deg, #e74c3c, #c0392b); border: none; color: white; padding: 12px 20px; border-radius: 25px; cursor: pointer; min-width: 100px;">
                <i class="fas fa-image"></i> Share Image
              </button>
            </div>
            <div class="swipe-indicator">
              <div class="swipe-left" ${index === 0 ? 'style="opacity: 0.3;"' : ''}>
                <i class="fas fa-arrow-left"></i> Swipe right
              </div>
              <div class="swipe-right" ${index === APP_DATA.slides.length - 1 ? 'style="opacity: 0.3;"' : ''}>
                Swipe left <i class="fas fa-arrow-right"></i>
              </div>
            </div>
          </div>
        `;
        
        container.appendChild(slideElement);
      });
    }

    function startPresentation() {
      // Hide bottom nav for presentation
      document.querySelector('.bottom-nav').style.display = 'none';
      
      // Show presentation screen
      document.querySelectorAll('.screen').forEach(screen => {
        screen.classList.remove('active');
        setTimeout(() => {
          if (screen.id !== 'presentation-screen') {
            screen.style.display = 'none';
          }
        }, 300);
      });
      
      const presentationScreen = document.getElementById('presentation-screen');
      presentationScreen.style.display = 'flex';
      setTimeout(() => {
        presentationScreen.classList.add('active');
      }, 10);
      
      appState.currentScreen = 'presentation-screen';
      appState.currentSlide = 0;
      trackEvent('presentation_started');
      
      // Reset all slides to initial state
      const slides = document.querySelectorAll('.slide');
      slides.forEach((slide, index) => {
        slide.classList.remove('active', 'previous', 'next');
        if (index === 0) {
          slide.classList.add('active');
        } else {
          slide.classList.add('next');
        }
      });
      
      // Update user stats
      if (!appState.userStats.presentations) appState.userStats.presentations = 0;
      appState.userStats.presentations++;
      saveUserStats();
    }

    function exitPresentation() {
      // Vibrate on exit
      navigator.vibrate?.(30);
      
      // Show bottom nav again
      document.querySelector('.bottom-nav').style.display = 'flex';
      
      // Return to home screen
      showScreen('home-screen');
    }

    // FIXED: Slide navigation functions - with haptics
    function nextSlide() {
      if (appState.currentSlide < APP_DATA.slides.length - 1) {
        // Vibrate on slide change
        navigator.vibrate?.(50);
        
        const currentSlide = document.querySelector(`#slide-${appState.currentSlide + 1}`);
        const nextSlide = document.querySelector(`#slide-${appState.currentSlide + 2}`);
        
        currentSlide.classList.remove('active');
        currentSlide.classList.add('previous');
        
        nextSlide.classList.remove('next');
        nextSlide.classList.add('active');
        
        appState.currentSlide++;
        
        // Track slide view
        trackSlideView(appState.currentSlide);
      }
    }

    function prevSlide() {
      if (appState.currentSlide > 0) {
        // Vibrate on slide change
        navigator.vibrate?.(50);
        
        const currentSlide = document.querySelector(`#slide-${appState.currentSlide + 1}`);
        const prevSlide = document.querySelector(`#slide-${appState.currentSlide}`);
        
        currentSlide.classList.remove('active');
        currentSlide.classList.add('next');
        
        prevSlide.classList.remove('previous');
        prevSlide.classList.add('active');
        
        appState.currentSlide--;
      }
    }

    // ==================== FIXED SHARE SYSTEM ====================
    function shareApp() {
      // Vibrate on share
      navigator.vibrate?.(30);
      
      const shareData = {
        title: 'GospelSwipe Pro',
        text: 'Check out this amazing gospel presentation app! Perfect for evangelism and personal devotion.',
        url: window.location.href
      };
      
      // Try Web Share API first
      if (navigator.share) {
        navigator.share(shareData)
          .then(() => {
            trackEvent('app_shared');
            showNotification('Thank you for sharing the gospel!', 'success');
            // Update share count
            appState.userStats.shares = (appState.userStats.shares || 0) + 1;
            saveUserStats();
          })
          .catch((error) => {
            console.log('Web Share failed:', error);
            fallbackShare();
          });
      } else {
        fallbackShare();
      }
      
      function fallbackShare() {
        // Copy to clipboard as fallback
        const textToCopy = `${shareData.text}\n\n${shareData.url}`;
        
        if (navigator.clipboard) {
          navigator.clipboard.writeText(textToCopy)
            .then(() => {
              showNotification('Link copied to clipboard! Share it with others.', 'success');
              trackEvent('app_shared_fallback');
            })
            .catch((err) => {
              console.error('Clipboard failed:', err);
              showNotification('Please copy the URL manually to share.', 'info');
            });
        } else {
          // Old school method
          const textArea = document.createElement('textarea');
          textArea.value = textToCopy;
          document.body.appendChild(textArea);
          textArea.select();
          
          try {
            document.execCommand('copy');
            showNotification('Link copied to clipboard!', 'success');
            trackEvent('app_shared_fallback');
          } catch (err) {
            console.error('Fallback copy failed:', err);
            showNotification('Please copy this URL to share: ' + window.location.href, 'info');
          }
          document.body.removeChild(textArea);
        }
      }
    }

    function shareVerse(verse, reference) {
      // Vibrate on share
      navigator.vibrate?.(30);
      
      const shareData = {
        title: 'Bible Verse',
        text: `${verse} - ${reference}\n\nShared via GospelSwipe Pro üìñ`,
        url: window.location.href
      };
      
      if (navigator.share) {
        navigator.share(shareData)
          .then(() => {
            trackEvent('verse_shared');
            showNotification('Verse shared successfully!', 'success');
            // Update share count
            appState.userStats.shares = (appState.userStats.shares || 0) + 1;
            saveUserStats();
            updateUserStats();
          })
          .catch((error) => {
            console.log('Verse share failed:', error);
            fallbackVerseShare(verse, reference);
          });
      } else {
        fallbackVerseShare(verse, reference);
      }
      
      function fallbackVerseShare(verse, reference) {
        const textToCopy = `${verse} - ${reference}\n\nShared via GospelSwipe Pro üìñ\n${window.location.href}`;
        
        if (navigator.clipboard) {
          navigator.clipboard.writeText(textToCopy)
            .then(() => {
              showNotification('Verse copied to clipboard!', 'success');
              trackEvent('verse_shared_fallback');
            })
            .catch((err) => {
              console.error('Clipboard failed:', err);
              showNotification('Please copy the verse manually.', 'info');
            });
        } else {
          const textArea = document.createElement('textarea');
          textArea.value = textToCopy;
          document.body.appendChild(textArea);
          textArea.select();
          
          try {
            document.execCommand('copy');
            showNotification('Verse copied to clipboard!', 'success');
            trackEvent('verse_shared_fallback');
          } catch (err) {
            console.error('Fallback copy failed:', err);
            showNotification(`Please copy this verse: ${verse} - ${reference}`, 'info');
          }
          document.body.removeChild(textArea);
        }
      }
    }

    // ==================== MODAL SYSTEM ====================
    function showModal(content, options = {}) {
      // Remove any existing modal
      const existingModal = document.querySelector('.modal-overlay');
      if (existingModal) existingModal.remove();
      
      const modal = document.createElement('div');
      modal.className = 'modal-overlay';
      modal.innerHTML = `
        <div class="modal-content">
          <button onclick="closeModal()" style="position: absolute; top: 15px; right: 15px; background: none; border: none; color: white; font-size: 1.5rem; cursor: pointer; z-index: 10;">
            <i class="fas fa-times"></i>
          </button>
          ${content}
        </div>
      `;
      
      document.body.appendChild(modal);
      setTimeout(() => {
        modal.classList.add('active');
      }, 10);
      
      // Prevent background scrolling
      document.body.style.overflow = 'hidden';
    }

    function closeModal() {
      const modal = document.querySelector('.modal-overlay');
      if (modal) {
        modal.classList.remove('active');
        setTimeout(() => {
          modal.remove();
          document.body.style.overflow = '';
        }, 300);
      }
    }

    // ==================== VOICE SYSTEM ====================
    function speakSlide(slideId) {
      const slide = APP_DATA.slides.find(s => s.id === slideId);
      if (!slide) return;
      
      const text = `${slide.title}. ${slide.verse}. ${slide.reference}`;
      
      if ('speechSynthesis' in window) {
        // Stop any ongoing speech
        speechSynthesis.cancel();
        
        // Create utterance
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = appState.language === 'en' ? 'en-US' : appState.language;
        utterance.rate = parseFloat(document.getElementById('voiceSpeed').value) || 1;
        utterance.pitch = 1.1;
        utterance.volume = 1;
        
        // Speak
        speechSynthesis.speak(utterance);
        
        // Track event
        trackEvent('voice_played', { slide: slideId });
        
        // Vibrate when audio starts
        navigator.vibrate?.(30);
      } else {
        showNotification('Voice synthesis not supported in your browser', 'error');
      }
    }

    // ==================== PRAYER JOURNAL ====================
    function savePrayer() {
      const text = document.getElementById('prayerInput').value.trim();
      if (!text) {
        showNotification('Please write a prayer first', 'error');
        return;
      }
      
      const prayer = {
        id: Date.now(),
        text: text,
        date: new Date().toISOString(),
        answered: false,
        language: appState.language,
        category: 'general'
      };
      
      appState.prayers.unshift(prayer);
      localStorage.setItem('prayers', JSON.stringify(appState.prayers));
      
      document.getElementById('prayerInput').value = '';
      loadPrayers();
      
      showNotification('Prayer saved! God hears you üôè', 'success');
      trackEvent('prayer_saved');
      updateUserStats();
      
      // Vibrate on save
      navigator.vibrate?.(50);
    }

    function loadPrayers() {
      // Show skeleton loader first
      const container = document.getElementById('prayerList');
      const skeleton = document.getElementById('prayerSkeleton');
      
      if (!container) return;
      
      // Show skeleton
      skeleton.style.display = 'block';
      container.innerHTML = skeleton.outerHTML;
      
      // Load actual content after brief delay
      setTimeout(() => {
        if (appState.prayers.length === 0) {
          container.innerHTML = `
            <div style="text-align: center; padding: 40px; opacity: 0.5;">
              <i class="fas fa-pray" style="font-size: 3rem; margin-bottom: 20px;"></i>
              <p>No prayers yet. Write your first prayer!</p>
            </div>
          `;
        } else {
          container.innerHTML = appState.prayers.map(prayer => `
            <div class="prayer-item ${prayer.answered ? 'answered' : ''}">
              <div class="prayer-date">
                ${new Date(prayer.date).toLocaleDateString()} ‚Ä¢ 
                ${getLanguageName(prayer.language)}
                <button onclick="toggleAnswered(${prayer.id})" style="float: right; background: none; border: none; color: ${prayer.answered ? '#e74c3c' : '#2ecc71'}; cursor: pointer;">
                  <i class="fas fa-${prayer.answered ? 'times' : 'check'}"></i>
                </button>
              </div>
              <div>${prayer.text}</div>
            </div>
          `).join('');
        }
      }, 300);
    }

    function toggleAnswered(prayerId) {
      const prayer = appState.prayers.find(p => p.id === prayerId);
      if (prayer) {
        prayer.answered = !prayer.answered;
        localStorage.setItem('prayers', JSON.stringify(appState.prayers));
        loadPrayers();
        
        if (prayer.answered) {
          showNotification('Prayer marked as answered! Praise God!', 'success');
          trackEvent('prayer_answered');
          // Vibrate on answered
          navigator.vibrate?.([50, 50, 100]); // Morse code for "yes"
        }
      }
    }

    function recordVoicePrayer() {
      if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
        showNotification('Voice recording started. Speak your prayer...', 'info');
        
        // This is a placeholder - in a real app, implement speech recognition
        setTimeout(() => {
          showNotification('Voice recording would work with proper browser permissions', 'info');
        }, 1000);
      } else {
        showNotification('Voice recording not supported in your browser', 'error');
      }
    }

    // ==================== AI SYSTEM ====================
    function askAI(topic) {
      const answer = APP_DATA.aiAnswers[topic];
      if (!answer) {
        showNotification('No answer available for this topic yet', 'error');
        return;
      }
      
      const answerText = answer[appState.language] || answer['en'];
      
      const modalContent = `
        <div style="color: white;">
          <div style="display: flex; align-items: center; margin-bottom: 20px;">
            <i class="fas fa-robot" style="font-size: 1.5rem; margin-right: 10px; color: #3498db;"></i>
            <h3 style="margin: 0;">AI Explanation</h3>
          </div>
          <div style="line-height: 1.6; margin-bottom: 20px; font-size: 1.1rem;">${answerText}</div>
          <div style="color: rgba(255,255,255,0.7); font-size: 0.9rem;">
            <i class="fas fa-info-circle"></i> Based on biblical principles
          </div>
          <!-- Add share AI answer button -->
          <div style="margin-top: 20px; text-align: center;">
            <button onclick="shareVersePicture('${answerText}', 'AI Insight', 'GospelSwipe AI')" style="
              background: linear-gradient(135deg, #3498db, #2980b9);
              color: white;
              border: none;
              padding: 10px 20px;
              border-radius: 25px;
              cursor: pointer;
            ">
              <i class="fas fa-share"></i> Share This Insight
            </button>
          </div>
        </div>
      `;
      
      showModal(modalContent);
      
      // Track AI usage
      if (!appState.userStats.aiQuestions) appState.userStats.aiQuestions = 0;
      appState.userStats.aiQuestions++;
      saveUserStats();
      trackEvent('ai_question_asked', { topic: topic });
      
      // Vibrate on AI answer
      navigator.vibrate?.(40);
    }

    // ==================== STATISTICS & GAMIFICATION ====================
    function updateUserStats() {
      // Initialize stats if not exists
      if (!appState.userStats) {
        appState.userStats = {
          presentations: 0,
          slidesViewed: [],
          prayers: appState.prayers.length,
          aiQuestions: 0,
          shares: 0,
          installDate: new Date().toISOString(),
          events: [],
          level: 'Beginner',
          levelProgress: 0
        };
      }
      
      // Update stats
      appState.userStats.prayers = appState.prayers.length;
      
      // Save to localStorage
      localStorage.setItem('userStats', JSON.stringify(appState.userStats));
      
      // Update display
      updateStatsDisplay();
    }

    function updateStatsDisplay() {
      // Update home screen stats
      document.getElementById('streakCount').textContent = appState.streak.count || 0;
      document.getElementById('versesShared').textContent = appState.userStats.slidesViewed?.length || 0;
      
      // Update stats screen
      document.getElementById('totalSlides').textContent = appState.userStats.slidesViewed?.length || 0;
      document.getElementById('prayerCount').textContent = appState.prayers.length;
      document.getElementById('streakDays').textContent = appState.streak.count || 0;
      document.getElementById('aiQuestions').textContent = appState.userStats.aiQuestions || 0;
      
      // Calculate user level
      const totalPoints = (appState.userStats.slidesViewed?.length || 0) + 
                         (appState.prayers.length * 2) + 
                         (appState.userStats.aiQuestions || 0) * 3 +
                         (appState.userStats.shares || 0) * 2;
      
      let level = 'Beginner';
      let levelProgress = Math.min((totalPoints / 50) * 100, 100);
      
      if (totalPoints > 50) {
        level = 'Evangelist';
        levelProgress = Math.min(((totalPoints - 50) / 50) * 100, 100);
      }
      if (totalPoints > 100) {
        level = 'Minister';
        levelProgress = Math.min(((totalPoints - 100) / 100) * 100, 100);
      }
      if (totalPoints > 200) {
        level = 'Revivalist';
        levelProgress = Math.min(((totalPoints - 200) / 200) * 100, 100);
      }
      if (totalPoints > 500) {
        level = 'Apostle';
        levelProgress = 100;
      }
      
      document.getElementById('userLevel').textContent = level;
      appState.userStats.level = level;
      appState.userStats.levelProgress = levelProgress;
      
      // Update achievements display
      updateAchievementsDisplay();
    }

    function checkStreak() {
      const today = new Date().toDateString();
      const lastDate = appState.streak.lastDate;
      
      if (lastDate === today) {
        // Already used today
        return;
      }
      
      const yesterday = new Date();
      yesterday.setDate(yesterday.getDate() - 1);
      
      if (lastDate === yesterday.toDateString()) {
        // Consecutive day
        appState.streak.count++;
      } else if (lastDate && lastDate !== today) {
        // Broken streak
        appState.streak.count = 1;
      } else {
        // First time
        appState.streak.count = 1;
      }
      
      appState.streak.lastDate = today;
      localStorage.setItem('streak', JSON.stringify(appState.streak));
      
      // Show streak notification if increased
      if (appState.streak.count > 1) {
        showNotification(`üî• ${appState.streak.count}-day streak! Keep going!`, 'success');
      }
    }

    function trackSlideView(slideId) {
      if (!appState.userStats.slidesViewed) {
        appState.userStats.slidesViewed = [];
      }
      
      if (!appState.userStats.slidesViewed.includes(slideId)) {
        appState.userStats.slidesViewed.push(slideId);
        saveUserStats();
        
        // Check for achievements
        checkAchievements();
      }
    }

    function checkAchievements() {
      const newAchievements = [];
      const totalPoints = (appState.userStats.slidesViewed?.length || 0) + 
                         (appState.prayers.length * 2) + 
                         (appState.userStats.aiQuestions || 0) * 3 +
                         (appState.userStats.shares || 0) * 2;
      
      if (appState.userStats.slidesViewed?.length >= 5 && !appState.achievements.includes('first_5')) {
        newAchievements.push('Learner - Viewed 5 slides');
        appState.achievements.push('first_5');
      }
      
      if (appState.userStats.slidesViewed?.length >= 10 && !appState.achievements.includes('all_slides')) {
        newAchievements.push('Scholar - Viewed all slides');
        appState.achievements.push('all_slides');
      }
      
      if (appState.prayers.length >= 3 && !appState.achievements.includes('prayer_warrior')) {
        newAchievements.push('Prayer Warrior - Saved 3 prayers');
        appState.achievements.push('prayer_warrior');
      }
      
      if (totalPoints >= 50 && !appState.achievements.includes('evangelist')) {
        newAchievements.push('Evangelist - Earned 50 points');
        appState.achievements.push('evangelist');
      }
      
      if (appState.userStats.shares >= 5 && !appState.achievements.includes('sharer')) {
        newAchievements.push('Sharer - Shared 5 verses');
        appState.achievements.push('sharer');
      }
      
      if (appState.streak.count >= 7 && !appState.achievements.includes('faithful')) {
        newAchievements.push('Faithful - 7 day streak');
        appState.achievements.push('faithful');
      }
      
      if (newAchievements.length > 0) {
        localStorage.setItem('achievements', JSON.stringify(appState.achievements));
        
        newAchievements.forEach(achievement => {
          showNotification(`üèÜ Achievement Unlocked: ${achievement}`, 'success');
          // Vibrate pattern for achievement
          navigator.vibrate?.([100, 50, 100, 50, 200]);
        });
        
        // Update achievements display
        updateAchievementsDisplay();
      }
    }

    function updateAchievementsDisplay() {
      const container = document.getElementById('achievementsList');
      if (!container) return;
      
      if (appState.achievements.length === 0) {
        container.innerHTML = '<div style="text-align: center; opacity: 0.5; padding: 20px;">No achievements yet. Keep using the app!</div>';
        return;
      }
      
      container.innerHTML = appState.achievements.map(achievement => `
        <div style="background: rgba(241, 196, 15, 0.1); border: 1px solid rgba(241, 196, 15, 0.3); border-radius: 10px; padding: 10px; margin-bottom: 10px;">
          <i class="fas fa-trophy" style="color: #f39c12; margin-right: 10px;"></i>
          ${achievement}
        </div>
      `).join('');
    }

    // ==================== SETTINGS ====================
    function toggleDarkMode() {
      appState.darkMode = !appState.darkMode;
      document.body.classList.toggle('dark-mode', appState.darkMode);
      localStorage.setItem('darkMode', appState.darkMode);
      
      // Vibrate on toggle
      navigator.vibrate?.(20);
    }

    function changeLanguage() {
      const select = document.getElementById('languageSelect');
      appState.language = select.value;
      localStorage.setItem('language', appState.language);
      
      showNotification(`Language changed to ${getLanguageName(appState.language)}`, 'success');
      trackEvent('language_changed', { language: appState.language });
      
      // Vibrate on language change
      navigator.vibrate?.(20);
    }

    function getLanguageName(code) {
      const languages = {
        en: 'English',
        yo: 'Yoruba',
        ig: 'Igbo',
        ha: 'Hausa',
        pcm: 'Nigerian Pidgin'
      };
      return languages[code] || 'English';
    }

    function updateVoiceSettings() {
      showNotification('Voice settings updated', 'info');
      // Vibrate on setting change
      navigator.vibrate?.(15);
    }

    // ==================== DATA MANAGEMENT ====================
    function exportData() {
      const data = {
        app: 'GospelSwipe Pro',
        version: APP_DATA.version,
        exportDate: new Date().toISOString(),
        userStats: appState.userStats,
        prayers: appState.prayers,
        streak: appState.streak,
        achievements: appState.achievements,
        language: appState.language,
        darkMode: appState.darkMode
      };
      
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `gospelswipe-backup-${new Date().toISOString().split('T')[0]}.json`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      
      showNotification('Data exported successfully!', 'success');
      trackEvent('data_exported');
      
      // Vibrate on export
      navigator.vibrate?.(50);
    }

    function clearData() {
      if (confirm('Are you sure? This will delete all your prayers and statistics.')) {
        localStorage.clear();
        location.reload();
      }
    }

    // ==================== PWA INSTALLATION ====================
    let deferredPrompt;
    
    function checkInstallPrompt() {
      window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredPrompt = e;
        document.getElementById('installBtn').style.display = 'block';
      });
    }

    function installApp() {
      if (deferredPrompt) {
        deferredPrompt.prompt();
        deferredPrompt.userChoice.then((choiceResult) => {
          if (choiceResult.outcome === 'accepted') {
            showNotification('App installed successfully!', 'success');
            appState.installed = true;
            localStorage.setItem('installed', 'true');
            document.getElementById('installBtn').style.display = 'none';
            trackEvent('app_installed');
            
            // Vibrate on install
            navigator.vibrate?.([100, 50, 100]);
          }
          deferredPrompt = null;
        });
      } else {
        showNotification('App is already installed or cannot be installed', 'info');
      }
    }

    // ==================== UTILITY FUNCTIONS ====================
    function showNotification(message, type = 'info') {
      const notification = document.getElementById('notification');
      const messageEl = document.getElementById('notificationMessage');
      
      // Set color based on type
      const colors = {
        success: '#2ecc71',
        error: '#e74c3c',
        info: '#3498db',
        warning: '#f39c12'
      };
      
      notification.style.background = colors[type] || colors.info;
      messageEl.textContent = message;
      notification.classList.add('show');
      
      // Vibrate based on notification type
      if (type === 'success') {
        navigator.vibrate?.([30, 30, 50]); // Success pattern
      } else if (type === 'error') {
        navigator.vibrate?.([100, 50, 100]); // Error pattern
      }
      
      // Auto hide after 3 seconds
      setTimeout(() => {
        notification.classList.remove('show');
      }, 3000);
    }

    function trackEvent(eventName, data = {}) {
      // In a real app, this would send to analytics
      console.log(`Event: ${eventName}`, data);
      
      // Store locally for stats
      if (!appState.userStats.events) appState.userStats.events = [];
      appState.userStats.events.push({
        event: eventName,
        data: data,
        timestamp: new Date().toISOString()
      });
      
      saveUserStats();
    }

    function saveUserStats() {
      localStorage.setItem('userStats', JSON.stringify(appState.userStats));
    }

    function showDailyVerse() {
      const randomVerse = APP_DATA.dailyVerses[Math.floor(Math.random() * APP_DATA.dailyVerses.length)];
      
      const modalContent = `
        <div style="text-align: center; color: white;">
          <i class="fas fa-star" style="font-size: 2rem; color: #f39c12; margin-bottom: 15px;"></i>
          <h3 style="margin-bottom: 20px;">Verse of the Day</h3>
          <div style="font-size: 1.3rem; line-height: 1.6; margin-bottom: 20px; font-style: italic;">
            "${randomVerse.verse}"
          </div>
          <div style="color: #f39c12; font-size: 1.1rem; margin-bottom: 30px;">
            ${randomVerse.ref}
          </div>
          <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
            <button onclick="shareVerse('${randomVerse.verse}', '${randomVerse.ref}')" style="
              background: #3498db; 
              color: white; 
              border: none; 
              padding: 12px 25px; 
              border-radius: 25px; 
              cursor: pointer;
              flex: 1;
              min-width: 120px;
            ">
              <i class="fas fa-share"></i> Share
            </button>
            <button onclick="shareVersePicture('${randomVerse.verse}', '${randomVerse.ref}', 'Verse of the Day')" style="
              background: #e74c3c;
              color: white;
              border: none;
              padding: 12px 25px;
              border-radius: 25px;
              cursor: pointer;
              flex: 1;
              min-width: 120px;
            ">
              <i class="fas fa-image"></i> Share Image
            </button>
            <button onclick="closeModal()" style="
              background: rgba(255,255,255,0.1); 
              color: white; 
              border: 1px solid rgba(255,255,255,0.3); 
              padding: 12px 25px; 
              border-radius: 25px; 
              cursor: pointer;
              flex: 1;
              min-width: 120px;
            ">
              Close
            </button>
          </div>
        </div>
      `;
      
      showModal(modalContent);
      trackEvent('daily_verse_viewed');
    }

    function showLanguageSettings() {
      showScreen('settings-screen');
      // Scroll to language section
      setTimeout(() => {
        document.getElementById('languageSelect').focus();
      }, 100);
    }

    // ==================== ENHANCED: CANVAS VERSE SHARING ====================
    async function shareVersePicture(verseText, reference, title = 'Gospel Verse') {
      // Vibrate on button press
      navigator.vibrate?.(20);
      
      // Create canvas (digital paper)
      const canvas = document.createElement('canvas');
      canvas.width = 1080; // High resolution for sharing
      canvas.height = 1080;
      const ctx = canvas.getContext('2d');
      
      // Draw background gradient based on verse topic
      const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
      gradient.addColorStop(0, '#2c3e50');
      gradient.addColorStop(1, '#5D4E86');
      ctx.fillStyle = gradient;
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      
      // Add decorative elements
      ctx.fillStyle = 'rgba(255,255,255,0.05)';
      ctx.beginPath();
      ctx.arc(canvas.width/2, canvas.height/2, 300, 0, Math.PI * 2);
      ctx.fill();
      
      // Draw main title if provided
      ctx.fillStyle = 'rgba(255,255,255,0.7)';
      ctx.font = 'bold 48px Arial';
      ctx.textAlign = 'center';
      ctx.fillText(title, canvas.width/2, 120);
      
      // Draw verse text - wrap if too long
      ctx.fillStyle = 'white';
      ctx.font = 'bold 56px Arial';
      ctx.textAlign = 'center';
      
      const maxWidth = canvas.width - 200;
      const lineHeight = 80;
      const lines = wrapText(ctx, `"${verseText}"`, maxWidth);
      
      lines.forEach((line, index) => {
        ctx.fillText(line, canvas.width/2, 400 + (index * lineHeight));
      });
      
      // Draw reference
      ctx.fillStyle = 'rgba(255,255,255,0.9)';
      ctx.font = '36px Arial';
      ctx.fillText(reference, canvas.width/2, canvas.height - 250);
      
      // Add GospelSwipe branding
      ctx.fillStyle = '#3498db';
      ctx.font = 'bold 32px Arial';
      ctx.fillText('GospelSwipe Pro', canvas.width/2, canvas.height - 100);
      
      // Add app tagline
      ctx.fillStyle = 'rgba(255,255,255,0.6)';
      ctx.font = '24px Arial';
      ctx.fillText('Digital Evangelism Platform', canvas.width/2, canvas.height - 60);
      
      // Add logo/emoji
      ctx.fillStyle = '#f39c12';
      ctx.font = '64px sans-serif';
      ctx.fillText('‚úùÔ∏è', canvas.width/2, canvas.height - 20);
      
      // Turn into picture and share
      canvas.toBlob(blob => {
        const file = new File([blob], "verse.png", { type: "image/png" });
        
        // Try to use Web Share API with files
        if (navigator.share && navigator.canShare && navigator.canShare({ files: [file] })) {
          navigator.share({
            files: [file],
            title: 'Gospel Verse',
            text: `Shared via GospelSwipe Pro üìñ`
          }).then(() => {
            trackEvent('verse_shared_as_image');
            showNotification('Verse image shared successfully!', 'success');
            // Update share stats
            appState.userStats.shares = (appState.userStats.shares || 0) + 1;
            saveUserStats();
            updateUserStats();
          }).catch(err => {
            console.log('Image share failed:', err);
            fallbackImageShare(blob);
          });
        } else {
          fallbackImageShare(blob);
        }
      });
      
      function fallbackImageShare(blob) {
        // Create download link as fallback
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `verse-${reference.replace(/[^a-zA-Z0-9]/g, '-')}.png`;
        a.click();
        
        showNotification('Verse image saved to downloads!', 'success');
        trackEvent('verse_image_downloaded');
        
        URL.revokeObjectURL(url);
      }
    }
    
    // Helper function to wrap text on canvas
    function wrapText(context, text, maxWidth) {
      const words = text.split(' ');
      const lines = [];
      let line = '';
      
      for (let n = 0; n < words.length; n++) {
        const testLine = line + words[n] + ' ';
        const metrics = context.measureText(testLine);
        const testWidth = metrics.width;
        
        if (testWidth > maxWidth && n > 0) {
          lines.push(line);
          line = words[n] + ' ';
        } else {
          line = testLine;
        }
      }
      lines.push(line);
      return lines;
    }

    function darkenColor(color, percent) {
      const num = parseInt(color.replace('#', ''), 16);
      const amt = Math.round(2.55 * percent);
      const R = (num >> 16) - amt;
      const G = (num >> 8 & 0x00FF) - amt;
      const B = (num & 0x0000FF) - amt;
      
      return '#' + (
        0x1000000 +
        (R < 255 ? R < 1 ? 0 : R : 255) * 0x10000 +
        (G < 255 ? G < 1 ? 0 : G : 255) * 0x100 +
        (B < 255 ? B < 1 ? 0 : B : 255)
      ).toString(16).slice(1);
    }

    // ==================== SERVICE WORKER REGISTRATION ====================
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('sw.js')
          .then(registration => {
            console.log('ServiceWorker registration successful');
          })
          .catch(err => {
            console.log('ServiceWorker registration failed: ', err);
          });
      });
    }

    // Add keyboard support for presentation
    document.addEventListener('keydown', function(e) {
      if (appState.currentScreen === 'presentation-screen') {
        if (e.key === 'ArrowRight' || e.key === ' ') {
          nextSlide();
        } else if (e.key === 'ArrowLeft') {
          prevSlide();
        } else if (e.key === 'Escape') {
          exitPresentation();
        }
      }
    });
  </script>
</body>
</html>
